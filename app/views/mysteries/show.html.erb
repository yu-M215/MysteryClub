<h2>投稿詳細</h2>

<div class="offset-1">
  <div class="row d-flex">
    <h4 class="mb-3"><%= @mystery.title %></h4>
    難易度：<p class="difficulty_level" data-score="<%= @mystery.difficulty_level %>"></p>
    <!-- 投稿ユーザーがログインユーザーと一致していたら編集ボタンと削除ボタンを表示 -->
    <% if @mystery.user_id == current_user.id %>
      <div class="col-5">
        <%= link_to "編集", edit_mystery_path(@mystery), class:"btn btn-primary" %>
        <%= link_to "削除", mystery_path(@mystery), method: :delete, data: {confirm: "編集ページから投稿を非公開にすることもできますが、本当に削除しますか？"}, class:"btn btn-danger" %>
      </div>
    <% end %>
  </div>
  <div class="row">
    <div class="col-4">
      <%= link_to Refile.attachment_url(@mystery, :image), "data-lightbox":"mystery_img", "data-title":"問題画像" do %>
        <%= attachment_image_tag @mystery, :image, alt:"MysteryImage", size:"300x200" %>
      <% end %>
    </div>
    <div class="col-6 ml-3">
      <%=safe_join(@mystery.discription.split("\n"),tag(:br))%>
    </div>
  </div>
  <div class="row mt-3">
    <div class="col-2" id="favorite-btn">
      <%= render 'favorites/favorite-btn', mystery: @mystery %>
    </div>
    <div class="col-2">
      <span id="comment-count">コメント数：<%= @mystery.comments.count %>件</span>
    </div>
    <div class="ml-3">
      投稿者：<%= @mystery.user.name %>
      <span class="ml-5">フォロー</span>
    </div>
  </div>
  <h6 class="mt-3" id="answer-button">答えはこちら <i class="fas fa-angle-double-down"></i></h6>

  <div class="row" id="answer-box">
    <% if @mystery.answer_image.present? %>
      <div class="col-4">
        <%= link_to Refile.attachment_url(@mystery, :answer_image), "data-lightbox":"answer_img", "data-title":"解説画像" do %>
          <%= attachment_image_tag @mystery, :answer_image, alt:"No Image", size:"300x200" %>
        <% end %>
      </div>
    <% end %>
    <div class="col-6 ml-3">
      <p>
        答え：<%= @mystery.answer %>
      </p>
      <P>
        解説：<%=safe_join(@mystery.answer_discription.split("\n"),tag(:br))%>
      </p>
    </div>
  </div>
  <%= render 'comments/form', mystery: @mystery, comment: @comment %>
  <table class="table" id="comment-table">
    <%= render 'comments/index', mystery: @mystery %>
  </table>
</div>

<script>
  $('.difficulty_level').raty({
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    },
    path: '/assets/'
  });
</script>